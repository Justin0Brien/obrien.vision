---
layout: null
title: "University Financial Flows: Interactive Sankey Diagram"
date: 2026-02-15
technologies: ['HTML']
interactive: true
---
{% raw %}

<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>University Financial Flows: Interactive Sankey Diagram</title>
    <!-- Load Plotly.js from CDN -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <!-- Google Fonts for a modern look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent-color: #2563eb;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        p.subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            max-width: 700px;
            margin: 0 auto;
        }

        .chart-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 30px;
            height: 750px; /* Slightly increased height for labels */
            position: relative;
        }

        #sankey-diagram {
            width: 100%;
            height: 100%;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .info-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border-left: 4px solid var(--accent-color);
        }

        .info-card h3 {
            margin-top: 0;
            font-size: 1.1rem;
        }

        .highlight {
            font-weight: 600;
            color: var(--accent-color);
        }

        footer {
            text-align: center;
            margin-top: 60px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>The Financial Engine of a UK University</h1>
        <p class="subtitle">
            An interactive visualisation of income sources and expenditure destinations for a hypothetical "average" UK university with a £400m turnover.
        </p>
    </header>

    <!-- The Main Chart Container -->
    <div class="chart-card">
        <div id="sankey-diagram"></div>
    </div>

    <!-- Explanatory Context -->
    <div class="info-grid">
        <div class="info-card">
            <h3>Income Volatility</h3>
            <p>
                Notice the significant reliance on <span class="highlight">International Tuition Fees</span> (25% of total). Unlike government grants, this stream is highly sensitive to geopolitical changes and visa policies. A 10% drop here can wipe out the annual surplus.
            </p>
        </div>
        <div class="info-card">
            <h3>The Wage Bill</h3>
            <p>
                Universities are people-centred organisations. Combined, <span class="highlight">Academic</span> and <span class="highlight">Professional Services</span> salaries typically consume 55% of all income. This "fixed" cost makes it difficult to reduce spending quickly during a downturn.
            </p>
        </div>
        <div class="info-card">
            <h3>Cross-Subsidy</h3>
            <p>
                Research often costs more to conduct than the grants cover. The diagram illustrates how unrestricted income (like tuition fees) flows into the central "Treasury" pot to top up the deficit in research funding.
            </p>
        </div>
    </div>

    <footer>
        <p>Data modelled on typical financial profiles of UK higher education institutions (HESA aggregates). Values in £ Millions.</p>
    </footer>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- HELPER FUNCTION: HEX TO RGBA ---
        function hexToRgba(hex, alpha) {
            var r = parseInt(hex.slice(1, 3), 16),
                g = parseInt(hex.slice(3, 5), 16),
                b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        // --- DATA CONFIGURATION ---
        const totalTurnover = 400; // £400m

        // Base Labels (names only)
        const nodeNames = [
            "University Treasury",       // 0
            "Tuition: Home (UK)",        // 1
            "Tuition: International",    // 2
            "Funding Body Grants",       // 3
            "Research Grants",           // 4
            "Residences & Catering",     // 5
            "Endowments & Donations",    // 6
            "Other Income",              // 7
            "Academic Staff Pay",        // 8
            "Prof. Services Pay",        // 9
            "Estates & Facilities",      // 10
            "Research Direct Costs",     // 11
            "Bursaries & Scholarships",  // 12
            "IT & Admin Costs",          // 13
            "Debt Interest",             // 14
            "Surplus / Reserves"         // 15
        ];

        // Colour Palette (Hex)
        const nodeColorsHex = [
            "#334155", // 0: Treasury (Dark Grey/Slate)
            "#3b82f6", // 1: Home Tuition (Blue)
            "#8b5cf6", // 2: Intl Tuition (Purple)
            "#10b981", // 3: Funding Body (Green)
            "#f59e0b", // 4: Research Grants (Amber)
            "#0ea5e9", // 5: Residences (Sky Blue)
            "#64748b", // 6: Endowment (Grey)
            "#94a3b8", // 7: Other (Light Grey)
            "#ef4444", // 8: Academic Pay (Red)
            "#f43f5e", // 9: Prof Pay (Rose)
            "#f97316", // 10: Estates (Orange)
            "#eab308", // 11: Research Costs (Yellow)
            "#14b8a6", // 12: Bursaries (Teal)
            "#6366f1", // 13: IT (Indigo)
            "#71717a", // 14: Debt (Zinc)
            "#22c55e"  // 15: Surplus (Green)
        ];

        // Flows: [Source Index, Target Index, Value (£m)]
        const linksData = [
            // --- INFLOWS (Source -> Treasury) ---
            { source: 1, target: 0, value: 110 },
            { source: 2, target: 0, value: 100 },
            { source: 3, target: 0, value: 45 },
            { source: 4, target: 0, value: 75 },
            { source: 5, target: 0, value: 40 },
            { source: 6, target: 0, value: 15 },
            { source: 7, target: 0, value: 15 },

            // --- OUTFLOWS (Treasury -> Destination) ---
            { source: 0, target: 8,  value: 130 },
            { source: 0, target: 9,  value: 90 },
            { source: 0, target: 10, value: 70 },
            { source: 0, target: 11, value: 50 },
            { source: 0, target: 12, value: 15 },
            { source: 0, target: 13, value: 25 },
            { source: 0, target: 14, value: 10 },
            { source: 0, target: 15, value: 10 }
        ];

        // --- PRE-PROCESSING FOR DISPLAY ---
        
        // 1. Calculate Percentages for Nodes and Format Labels
        // We need to sum up values for each node to get its total size
        let nodeValues = new Array(nodeNames.length).fill(0);
        
        linksData.forEach(l => {
            // For source nodes (1-7), value is what they send
            // For destination nodes (8-15), value is what they receive
            // Treasury (0) is special, handled by flows in/out
            if(l.source !== 0) nodeValues[l.source] += l.value;
            if(l.target !== 0) nodeValues[l.target] += l.value;
        });
        nodeValues[0] = totalTurnover; // Hardset Treasury to total

        // Create Enhanced Labels: "Name \n £Xm (Y%)"
        const nodeLabels = nodeNames.map((name, i) => {
            const val = nodeValues[i];
            const pct = ((val / totalTurnover) * 100).toFixed(1);
            return `${name}\n£${val}m (${pct}%)`;
        });

        // 2. Process Links (Arrays for Plotly)
        const sourceIndices = linksData.map(l => l.source);
        const targetIndices = linksData.map(l => l.target);
        const values = linksData.map(l => l.value);
        
        // Create Link Colours (Inherit from Source with opacity)
        const linkColors = linksData.map(l => {
            const sourceColor = nodeColorsHex[l.source];
            // Use 0.3 opacity for ribbons to show overlap beautifully
            return hexToRgba(sourceColor, 0.4);
        });

        // Create Custom Hover Text for Links
        const linkCustomData = linksData.map(l => {
            const pct = ((l.value / totalTurnover) * 100).toFixed(1);
            return {
                amount: l.value,
                percent: pct
            };
        });

        const data = [
            {
                type: "sankey",
                orientation: "h",
                valueformat: ".0f",
                valuesuffix: "m",
                node: {
                    pad: 20,
                    thickness: 25,
                    line: {
                        color: "black",
                        width: 0.5
                    },
                    label: nodeLabels,
                    color: nodeColorsHex,
                    // Hover for Nodes
                    hovertemplate: '<b>%{label}</b><extra></extra>',
                    
                    // Styling the text inside the chart
                    textfont: {
                        family: "Inter, sans-serif",
                        size: 13,
                        color: "#1e293b"
                    }
                },
                link: {
                    source: sourceIndices,
                    target: targetIndices,
                    value: values,
                    color: linkColors,
                    // Custom hover for Links
                    // We interpret the flow context based on whether source is Treasury or not
                    hovertemplate: 
                        '<b>%{source.label}</b> → <b>%{target.label}</b><br>' +
                        'Value: <b>£%{value}m</b><br>' +
                        'Share of Total Budget: <b>%{customdata.percent}%</b>' +
                        '<extra></extra>',
                    customdata: linkCustomData
                }
            }
        ];

        const layout = {
            font: {
                family: "Inter, sans-serif",
                size: 14,
                color: "#1e293b"
            },
            paper_bgcolor: "rgba(0,0,0,0)",
            plot_bgcolor: "rgba(0,0,0,0)",
            margin: { l: 10, r: 10, t: 30, b: 30 },
            autosize: true
        };

        const config = {
            responsive: true,
            displayModeBar: false
        };

        Plotly.newPlot('sankey-diagram', data, layout, config);
    });
</script>

</body>
</html>
{% endraw %}
